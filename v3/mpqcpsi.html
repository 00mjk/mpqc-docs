<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPQC: Running Psi 3 from MPQC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MPQC
   &#160;<span id="projectnumber">3.0.0-alpha</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('mpqcpsi.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Running Psi 3 from MPQC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="http://www.psicode.org/">Psi 3</a> is a suite of <em>ab initio</em> codes related to the original Psi package started in Prof. Fritz Schaefer's group at UC Berkeley. Current version of MPQC works with stable versions of Psi 3 starting with 3.2.0. From now on we will refer to Psi 3 as simply Psi. Psi is written primarily in C and executes in serial mode only. The interface between Psi and MPQC is intended mainly for Psi users who wish to exploit MPQC's geometry optimization and frequency analyses capabilities with Psi energies and gradients.</p>
<p>The following sections explain how to use Psi from MPQC:</p>
<ul>
<li>
<a class="el" href="mpqcpsi.html#psiworks">How the MPQC-Psi interface works</a> </li>
<li>
<a class="el" href="mpqcpsi.html#psienv">Environmental Variables</a> </li>
<li>
<a class="el" href="mpqcpsi.html#psiinp">Preparing an input file</a> </li>
<li>
<a class="el" href="mpqcpsi.html#psiexenv">Psi Execution Environment</a> </li>
<li>
<a class="el" href="mpqcpsi.html#psiwfn">PsiWavefunction specializations</a> </li>
<li>
<a class="el" href="mpqcpsi.html#examples">More examples</a> </li>
</ul>
<h1><a class="anchor" id="psiworks"></a>
How the MPQC-Psi interface works</h1>
<p>The current version of the interface is rather slim. It is only possible to import energies and gradients computed with Psi into MPQC, i.e. wave functions cannot be imported. All MPQC-Psi interaction happens via text files and system calls. MPQC generates input file for Psi, calls appropriate Psi modules, and then parses the output files for energies and gradients.</p>
<h1><a class="anchor" id="psienv"></a>
Environmental Variables</h1>
<p>Several environmental variables are used to control MPQC-Psi interaction: </p><dl>
<dt><code>PSIBIN</code></dt>
<dd>By default, MPQC will try to find Psi binaries under <code>/usr/local/psi/bin</code>. Use <code>PSIBIN</code> environmental variable to point to the right location. </dd>
</dl>
<p>The rest of the Psi environment is job specific and specified in the input file.</p>
<h1><a class="anchor" id="psiinp"></a>
Preparing an input file</h1>
<p>As noted above, MPQC parses the input file, and as such the input file has to be in the MPQC OO input format. All features of usual MPQC input files are there (<code>mpqc</code> section, <code>mole</code> MolecularEnergy object, etc.). In addition the following rules apply: </p><ul>
<li>
instead of using MPQC Wavefunction objects (CLHF, MBPT2, etc.), the Psi specific Wavefunction types (i.e. specializations of PsiWavefunction) have to be used. Presently the following specializations are supported: PsiCLHF, PsiHSOSHF, PsiUHF, PsiCCSD, PsiCCSD_T . The first three are directly analogous to MPQC Wavefunction types CLHF, HSOSHF, and UHF. The latter two do not have MPQC analogs yet. See appropriate class documentation on how to specify them properly. </li>
<li>
each Psi-specific Wavefunction object has to have a member object <code>psienv</code> of type PsiExEnv. PsiExEnv contains job specific information, such as the directory in which Psi input, output, and checkpoint files will be kept, filename prefix, scratch directories, etc. It makes sense to define one such object and simply refer to it from all PsiWavefunction objects. See PsiExEnv class documentation for more info. </li>
</ul>
<h1><a class="anchor" id="psiexenv"></a>
Psi Execution Environment</h1>
<p>Each PsiWavefunction-derived class has to have a member object called <code>psienv</code> of type PsiExEnv. The following keywords are used by its KeyVal constructor: </p><dl>
<dt><code>cwd</code></dt>
<dd>The directory where to keep Psi input, checkpoint, stdout, stderr, and other files. Default is <code>/tmp</code>. </dd>
<dt><code>fileprefix</code></dt>
<dd>The file prefix to use for Psi checkpoint, scratch, and some ASCII files. Equivalent to keyword <code>name</code> in Psi <code>psi:files:default</code> section. Defaults to <code>psi</code>. </dd>
<dt><code>stdout</code></dt>
<dd>The file into which to redirect standard output of Psi modules. Defaults to <code>psi.stdout</code>. </dd>
<dt><code>stderr</code></dt>
<dd>The file into which to redirect standard error of Psi modules. Defaults to <code>psi.stderr</code>. </dd>
<dt><code>nscratch</code></dt>
<dd>The number of locations over which to stripe Psi binary files. Equivalent to keyword <code>nvolume</code> in Psi <code>psi:files:default</code> section. Default is 1. </dd>
<dt><code>scratch</code></dt>
<dd>The locations over which to stripe Psi binary files. Equivalent to keyword <code>volume<em>x</em></code> in Psi <code>psi:files:default</code> section. There's no default. </dd>
</dl>
<p>Here's an example: </p><pre>
  psienv&lt;PsiExEnv&gt;: (
    cwd = ./
    fileprefix = psi.test
    nscratch = 2
    scratch = [ "/scratch1/" "/scratch2/" ]
  )
</pre><p> <br  />
</p>
<h1><a class="anchor" id="psiwfn"></a>
PsiWavefunction specializations</h1>
<p>Class PsiWavefunction is derived from class Wavefunction, hence its KeyVal constructor uses all keywords that Wavefunction's KeyVal constructor uses (<code>basis</code>, <code>molecule</code>, etc.). In addition, PsiWavefunction's KeyVal constructor looks for the following keywords in the input file: </p><dl>
<dt><code>psienv</code></dt>
<dd>The PsiExEnv object that provides job specific Psi environment. There's no default. </dd>
<dt><code>docc</code></dt>
<dd>An optional array of integers that specifies the number of doubly-occupied orbitals in each irrep. </dd>
<dt><code>socc</code></dt>
<dd>An optional array of integers that specifies the number of singly-occupied orbitals in each irrep. </dd>
<dt><code>frozen_docc</code></dt>
<dd>An optional array of integers that specifies the number of doubly-occupied orbitals in each irrep frozen in correlated computations. </dd>
<dt><code>frozen_uocc</code></dt>
<dd>An optional array of integers that specifies the number of unoccupied orbitals in each irrep frozen in correlated computations. </dd>
<dt><code>total_charge</code></dt>
<dd>The total charge of the system. This keyword is queried only if neither <code>docc</code> nor <code>socc</code> are given. </dd>
<dt><code>multiplicity</code></dt>
<dd>The spin multiplicity of the system (2*M_S+1). This keyword is queried only if neither <code>docc</code> nor <code>socc</code> are given. </dd>
<dt><code>memory</code></dt>
<dd>The number of bytes of memory Psi modules associated with this PsiWavefunction are allowed to use. Default is 32000000 (32 million bytes, approximately 32 MB). </dd>
</dl>
<p>Note that keywords <code>docc</code>, <code>socc</code>, <code>frozen_docc</code>, <code>frozen_uocc</code>, <code>total_charge</code>, and <code>multiplicity</code> are used by appropriate specializations of PsiWavefunctions, i.e. PsiCLHF only checks for <code>docc</code>, etc.</p>
<p>PsiWavefunction specializations PsiCCSD and PsiCCSD_T also look for keyword <code>reference</code> which specifies the reference wave function (an object of type PsiSCF). All classes for correlated Psi wave functions will require such an object.</p>
<p>Here are a few examples of PsiWavefunctions: </p><pre>
  %
  % ROHF DZ on F atom
  %
  mole&lt;PsiHSOSHF&gt;: (
    docc = [ 2 0 0 0 0 1 1 0 ] socc = [ 0 0 0 0 0 0 0 1]
    memory = 10000000</pre><pre>    % Psi Environment data
    psienv&lt;PsiExEnv&gt;: (
      cwd = ./
      fileprefix = f.dz.test
      stdout = f.dz.test.stdout
      stderr = f.dz.test.stderr
      nscratch = 1
      scratch = [ "/scratch/mpqc/" ]
    )</pre><pre>    % MolecularEnergy input
    molecule&lt;Molecule&gt;: (
        {atoms geometry} = {
          F  [   0.0  0.0   0.0 ]
         }
      )</pre><pre>    % Basis input
    basis&lt;GaussianBasisSet&gt;: (
        molecule = $..:molecule
        name = "DZ (Dunning)"
      )</pre><pre>  )
</pre><p> <br  />
</p>
<pre>
  %
  % RHF CCSD/cc-pVDZ on water
  %
  mole&lt;PsiCCSD&gt;: (
    frozen_docc = [1 0 0 0]
    memory = 40000000</pre><pre>    % Psi Environment data
    psienv&lt;PsiExEnv&gt;: (
      cwd = ./
      fileprefix = h2o.ccpvdz.ccsd.test
      nscratch = 1
      scratch = [ "/tmp/" ]
    )</pre><pre>    % MolecularEnergy input
    molecule&lt;Molecule&gt;: (
        {atoms geometry} = {
          H  [  -1.5  0.0  -0.3 ]
          H  [   1.5  0.0  -0.3 ]
          O  [   0.0  0.0   1.0 ]
         }
      )</pre><pre>    % Basis input
    basis&lt;GaussianBasisSet&gt;: (
        molecule = $..:molecule
        name = "cc-pVDZ"
      )</pre><pre>    reference&lt;PsiCLHF&gt;: (
      psienv = $..:psienv
      molecule = $..:molecule
      basis = $..:basis
      total_charge = 0
      multiplicity = 1
    )
  )
</pre><p> <br  />
</p>
<h1><a class="anchor" id="examples"></a>
More examples</h1>
<p>This section contains some examples of complete inputs that specify an MPQC/Psi computations.</p>
<p>Here's an optimization + subsequent frequency analysis on water molecule at the RHF CCSD 6-311G** level: </p><pre>
% Emacs should use -*- KeyVal -*- mode
% this file was automatically generated
% label: water test series
% molecule specification
molecule&lt;Molecule&gt;: (
  symmetry = C2V
  unit = angstrom
  { atoms geometry } = {
     O     [     0.000000000000     0.000000000000     0.369372944000 ]
     H     [     0.783975899000     0.000000000000    -0.184686472000 ]
     H     [    -0.783975899000     0.000000000000    -0.184686472000 ]
  }
)
% basis set specification
basis&lt;GaussianBasisSet&gt;: (
  name = "6-311G**"
  molecule = $:molecule
)
% Psi environment specification
psienv&lt;PsiExEnv&gt;: (
      cwd = ./
      fileprefix = mpqcpsi
      stdout = mpqcpsi.stdout
      stderr = mpqcpsi.stderr
      nscratch = 1
      scratch = [ "/scratch/evaleev/" ]
)</pre><pre>mpqc: (
  checkpoint = no
  savestate = no
  restart = no
  coor&lt;SymmMolecularCoor&gt;: (
    molecule = $:molecule
    generator&lt;IntCoorGen&gt;: (
      molecule = $:molecule
    )
  )
  % molecular coordinates for optimization  do_energy = yes
  do_gradient = no
  % method for computing the molecule's energy
  mole&lt;PsiCCSD&gt;: (
    molecule = $:molecule
    basis = $:basis
    coor = $..:coor
    psienv = $:psienv
    memory = 32000000
    reference&lt;PsiCLHF&gt;: (
      psienv = $:psienv
      molecule = $:molecule
      total_charge = 0
      multiplicity = 1
      basis = $:basis
      memory = 32000000
    )
  )
  optimize = yes
  % optimizer object for the molecular geometry
  opt&lt;QNewtonOpt&gt;: (
    max_iterations = 20
    function = $..:mole
    update&lt;BFGSUpdate&gt;: ()
    convergence&lt;MolEnergyConvergence&gt;: (
      cartesian = yes
      energy = $..:..:mole
    )
  )
% vibrational frequency input
  do_freq = true
  freq&lt;MolecularFrequencies&gt;: (
    point_group&lt;PointGroup&gt;: symmetry = C2V
    molecule = $:molecule
  )
  hess&lt;FinDispMolecularHessian&gt;: (
    point_group&lt;PointGroup&gt;: symmetry = C2V
    checkpoint = no
    restart = no
  )
)
</pre><p> <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<hr>
<address>
<small>
Generated at Sun Jan 26 2020 23:24:02 for <a
href="http://www.mpqc.org">MPQC</a>
3.0.0-alpha using the documentation package <a
href="http://www.doxygen.org">Doxygen</a>
1.8.16.
</small>
</address>
</body>
</html>
