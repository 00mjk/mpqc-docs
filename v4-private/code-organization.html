<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.20"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>MPQC: Code Organization</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
        <script type="text/javascript" src="jquery.smartmenus.js"></script>
        <!-- SmartMenus jQuery Bootstrap Addon -->
        <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
        <!-- SmartMenus jQuery plugin -->
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">MPQC 4.0.0-beta.1</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="intro.html"><span>Introduction</span></a></li>
      <li><a href="userguide.html"><span>User&#160;Guide</span></a></li>
      <li><a href="usergroup0.html"><span>Programmer&#160;Guides</span></a></li>
      <li><a href="usergroup1.html"><span>Source&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Code Organization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="code-organization-modules"></a>
Modules</h1>
<p>MPQC is a collection of libraries linked into a small end-user program. Each library is a logical module; eventually they will become C++ modules, with proper separation between public interface and implementation details, when support for modules by the compilers and build tools becomes more mature. In the meantime, it is programmer's responsibility to organize the MPQC source code and build harness appropriately to emulate modular behavior.</p>
<p>Modular structure of MPQC is shown below.</p>
<div class="image">
<img src="modules.png" alt=""/>
<div class="caption">
Modular structure of MPQC</div></div>
   <p>Source code organization, as detailed in <a class="el" href="srctree.html">The Source Tree</a> , directly mirrors the modular structure of MPQC. The following rules govern the source code structure, and the related structure of the build harness.</p>
<p><b>1 Library per Directory</b>: Each library should be located in its own directory, with single <code>CMakeLists.txt</code>. There may be additional subdirectories, if needed, but they should not contain their own <code>CMakeLists.txt</code>. Library's <code>CMakeLists.txt</code> defines the <a href="https://cmake.org/cmake/help/latest/command/add_library.html#normal-libraries">CMake library target</a> by invoking either <code>add_mpqc_hdr_library</code> (for a header-only library) or <code>add_mpqc_library</code> (for non-header-only library). Dependence of the library on other MPQC libraries and external dependencies (which have corresponding CMake imported targets) must be explicitly expressed by establishing dependence of the CMake library target of the corresponding prerequisite targets. Library's dependence on its prerequisites can occur at compile-time (by <code>#include</code> public header files of the prerequisite) and link-time (by containing references to symbols defined in the prerequisite's public binary artifacts, such as, object files, static libraries, shared libraries, and frameworks). Both types of dependencies must be specified explicitly. N.B. although omitting compile-time dependence on other MPQC libraries usually will not cause a mis-build, it can; specifying compile-time dependencies between CMake targets will also help to determine dependencies between MPQC C++ modules in the future.</p>
<p>This example shows how the CMake target is defined for the library located in <code>src/mpqc/chemistry/qc/lcao/wfn</code>: </p><div class="fragment"><div class="line"><span class="comment"># usually single list of source files is sufficient</span></div>
<div class="line"><span class="comment"># if some headers are non-public it may be necessary</span></div>
<div class="line"><span class="comment"># to specify the list of public headers separately</span></div>
<div class="line">set(sources</div>
<div class="line">  ao_wfn.cpp  ao_wfn.h  fwd.h</div>
<div class="line">  lcao_wfn.cpp  lcao_wfn.ipp  lcao_wfn.h</div>
<div class="line">  linkage.h  periodic_ao_wfn.cpp  periodic_ao_wfn.h</div>
<div class="line">  population_analysis.cpp  population_analysis.h</div>
<div class="line">  util.h  wfn.cpp  wfn.h</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># this defines MPQClcao_wfn library target</span></div>
<div class="line">add_mpqc_library(</div>
<div class="line">  <span class="comment"># library basename</span></div>
<div class="line">  lcao_wfn</div>
<div class="line">  <span class="comment"># list of source files (header files in the list will be ignored)</span></div>
<div class="line">  sources</div>
<div class="line">  <span class="comment"># list of public header files (non-header files in the list will be ignored)</span></div>
<div class="line">  sources</div>
<div class="line">  <span class="comment"># list of CMake targets on which this target will depend on</span></div>
<div class="line">  <span class="comment"># this may include both MPQC target and non-MPQC (hence, imported) targets</span></div>
<div class="line">  <span class="stringliteral">&quot;MPQCwfn;MPQClcao_factory;MPQCutil_misc;MPQCutil_keyval;MPQCmolecule;tiledarray&quot;</span></div>
<div class="line">  <span class="comment"># location of the public headers in the install tree</span></div>
<div class="line">  <span class="stringliteral">&quot;mpqc/chemistry/qc/lcao/wfn&quot;</span></div>
<div class="line">)</div>
</div><!-- fragment --><p><b>Single Forward Declaration Header</b>: Each library's forward declarations are collected in the <code>fwd.h</code> file. <em>work in progress</em></p>
<p><b>Explicit Instantiation of Template Functions/Classes</b>: Expensive-to-compile template classes and functions should be instantiated and included in library's binary artifact. Implementations of such templates should be separated from the header file in which they are declared and included in a separate "implementation header" file; following <a href="https://boost.org/">Boost</a> such file should have <code>.ipp</code> extension. <em>work in progress</em></p>
<p><b>Single Linkage Artifacts Header</b>: Each library's forward declarations are collected in the <code>linkage.h</code> file. <em>work in progress</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->

<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
    Generated at Fri Feb 12 2021 13:12:41 for <a href="http://www.mpqc.org">MPQC</a>
    4.0.0-beta.1 by &#160;<a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.20
</small></address>
</body>
<script type="text/javascript" src="doxy-boot.js"></script>
</html>
